<div class="container">
  <div class="row">
    <div class="col l6 offset-l3 s12 ">
      <div class="survey-container">
        <div class="survey-header">
          <h3><%= @trip.name %>'s survey</h3>
        </div>
        <div class="survey-body">
          <div class="survey-table">
            <div class="survey-line">
              <div class="survey-dates">
                <%= t('date.start_date') %>
                <%= t('date.end_date') %>
              </div>
            </div>
            <% @survey_dates.each do |survey_date| %>
            <div class="survey-line">
              <input name="group1" class="vote-button" type="checkbox" <%= survey_date.voted_by?(current_user) ? 'checked' :"" %> id="<%= survey_date.id %>" />
              <label for="<%= survey_date.id %>"></label>
              <%= survey_date.votes_for.size %>
              <div class="survey-dates">
                <%= l(survey_date.start_date, format: :short) %>
                <i class="material-icons">trending_flat</i>
                <%= l(survey_date.end_date, format: :short) %>
              </div>
            </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<%= link_to t('back'), trips_path, class: "btn" %>

<%= content_for :js do %>
    <%= javascript_tag do %>
        $('.vote-button').on("click", function(){
          $.ajax({
              type: "GET",
              url: "<%= vote_survey_path(@survey) %>",
              data: { survey_date_id: $(this).attr('id') },
              success: function(data){
                  var id = data.survey_date.id;
                  var numberOfVotes = data.number_of_votes;
                  $('#votes-for-survey-date-' + id).text(numberOfVotes);
              },
              error: function(jqXHR) {
                  console.error(jqXHR.responseText);
              }
          });
        });
    <% end %>
<% end %>